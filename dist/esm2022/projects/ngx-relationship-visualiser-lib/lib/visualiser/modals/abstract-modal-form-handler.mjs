import { FormArray, Validators } from '@angular/forms';
import fontAwesomeIcons from '../../models/font-awesome-icons';
export class AbstractModalFormHandler {
    fb;
    createLinkForm;
    createNodeForm;
    fontAwesomeIcons = fontAwesomeIcons;
    constructor(fb) {
        this.fb = fb;
        this.createLinkForm = this.fb.group({
            lineStyle: ['Dotted', Validators.required],
            sourceArrow: [false],
            targetArrow: [false],
            label: this.fb.array([], Validators.required),
        });
        this.createNodeForm = this.fb.group({
            id: '',
            label: this.fb.array([], [Validators.required, this.minLengthArray(1)]),
            imageUrl: [''],
            icon: [''],
            fx: [null],
            fy: [null],
            additionalIcon: [''],
            iconType: ['select'],
        }, { validators: this.iconOrImageValidator });
    }
    get labelArray() {
        return this.createLinkForm.get('label');
    }
    get nodeLabelArray() {
        return this.createNodeForm.get('label');
    }
    addLabel() {
        const labelGroup = this.fb.group({
            label: ['', Validators.required],
            linkIcon: [false],
        });
        this.labelArray.push(labelGroup);
    }
    addNodeLabel() {
        const labelGroup = this.fb.group({
            label: ['', Validators.required],
        });
        this.nodeLabelArray.push(labelGroup);
    }
    removeLabel(index) {
        if (this.labelArray.length > 1) {
            this.labelArray.removeAt(index);
        }
    }
    removeNodeLabel(index) {
        if (this.nodeLabelArray.length > 1) {
            this.nodeLabelArray.removeAt(index);
        }
    }
    resetLinksForm() {
        this.createLinkForm.reset({
            lineStyle: 'Dotted',
            sourceArrow: false,
            targetArrow: false,
            label: this.fb.array([]),
        });
        this.labelArray.clear();
    }
    resetNodeForm() {
        this.createNodeForm.reset({
            label: this.fb.array([]),
            imageUrl: '',
            icon: '',
            additionalIcon: '',
            iconType: 'select',
        });
        this.nodeLabelArray.clear();
    }
    populateEditLinkForm(data) {
        this.createLinkForm.patchValue({
            lineStyle: data.lineStyle,
            sourceArrow: data.sourceArrow,
            targetArrow: data.targetArrow
        });
        if (data.relationships && Array.isArray(data.relationships)) {
            data.relationships.forEach((relationship) => {
                const labelGroup = this.fb.group({
                    labelIndex: [relationship.labelIndex, Validators.required],
                    label: [relationship.label, Validators.required],
                    linkIcon: [relationship.linkIcon]
                });
                this.labelArray.push(labelGroup);
            });
        }
    }
    populateEditNodeForm(data) {
        this.createNodeForm.patchValue({
            id: data.id,
            imageUrl: data.imageUrl,
            icon: data.icon,
            fx: data.fx,
            fy: data.fy,
            additionalIcon: data.additionalIcon,
            iconType: data.imageUrl ? 'url' : 'select'
        });
        this.createNodeForm.setControl('label', this.fb.array(data.label.map(label => this.fb.group({ label: [label, Validators.required] }))));
    }
    iconOrImageValidator(control) {
        const imageUrl = control.get('imageUrl').value;
        const icon = control.get('icon').value;
        if ((imageUrl && icon) || (!imageUrl && !icon)) {
            return { 'iconOrImage': true };
        }
        return null;
    }
    minLengthArray(min) {
        return (control) => {
            if (control instanceof FormArray) {
                return control.length >= min ? null : { minLengthArray: true };
            }
            return null;
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtbW9kYWwtZm9ybS1oYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXJlbGF0aW9uc2hpcC12aXN1YWxpc2VyLWxpYi9saWIvdmlzdWFsaXNlci9tb2RhbHMvYWJzdHJhY3QtbW9kYWwtZm9ybS1oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBMEIsU0FBUyxFQUFFLFVBQVUsRUFBbUIsTUFBTSxnQkFBZ0IsQ0FBQztBQUVoRyxPQUFPLGdCQUFnQixNQUFNLGlDQUFpQyxDQUFDO0FBRS9ELE1BQU0sT0FBZ0Isd0JBQXdCO0lBS3RCO0lBSnRCLGNBQWMsQ0FBWTtJQUMxQixjQUFjLENBQVk7SUFDbkIsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7SUFFM0MsWUFBc0IsRUFBZTtRQUFmLE9BQUUsR0FBRixFQUFFLENBQWE7UUFDbkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQztZQUNsQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQztZQUMxQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDcEIsV0FBVyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ3BCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQztTQUM5QyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ2xDLEVBQUUsRUFBRSxFQUFFO1lBQ04sS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFD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LENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDaEYsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVPLG9CQUFvQixDQUFDLE9BQXdCO1FBQ25ELE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQy9DLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDL0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUNqQyxDQUFDO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU8sY0FBYyxDQUFDLEdBQVc7UUFDaEMsT0FBTyxDQUFDLE9BQXdCLEVBQXFDLEVBQUU7WUFDckUsSUFBSSxPQUFPLFlBQVksU0FBUyxFQUFFLENBQUM7Z0JBQ2pDLE9BQU8sT0FBTyxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUM7WUFDakUsQ0FBQztZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDO0lBQ0osQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCwgRm9ybUFycmF5LCBWYWxpZGF0b3JzLCBBYnN0cmFjdENvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBMaW5rLCBSZWxhdGlvbnNoaXAsIE5vZGUgfSBmcm9tICcuLi8uLi9tb2RlbHMvZGF0YS5pbnRlcmZhY2UnO1xuaW1wb3J0IGZvbnRBd2Vzb21lSWNvbnMgZnJvbSAnLi4vLi4vbW9kZWxzL2ZvbnQtYXdlc29tZS1pY29ucyc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdE1vZGFsRm9ybUhhbmRsZXIge1xuICBjcmVhdGVMaW5rRm9ybTogRm9ybUdyb3VwO1xuICBjcmVhdGVOb2RlRm9ybTogRm9ybUdyb3VwO1xuICBwdWJsaWMgZm9udEF3ZXNvbWVJY29ucyA9IGZvbnRBd2Vzb21lSWNvbnM7XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGZiOiBGb3JtQnVpbGRlcikge1xuICAgIHRoaXMuY3JlYXRlTGlua0Zvcm0gPSB0aGlzLmZiLmdyb3VwKHtcbiAgICAgIGxpbmVTdHlsZTogWydEb3R0ZWQnLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcbiAgICAgIHNvdXJjZUFycm93OiBbZmFsc2VdLFxuICAgICAgdGFyZ2V0QXJyb3c6IFtmYWxzZV0sXG4gICAgICBsYWJlbDogdGhpcy5mYi5hcnJheShbXSwgVmFsaWRhdG9ycy5yZXF1aXJlZCksXG4gICAgfSk7XG5cbiAgICB0aGlzLmNyZWF0ZU5vZGVGb3JtID0gdGhpcy5mYi5ncm91cCh7XG4gICAgICBpZDogJycsXG4gICAgICBsYWJlbDogdGhpcy5mYi5hcnJheShbXSwgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIHRoaXMubWluTGVuZ3RoQXJyYXkoMSldKSxcbiAgICAgIGltYWdlVXJsOiBbJyddLFxuICAgICAgaWNvbjogWycnXSxcbiAgICAgIGZ4OiBbbnVsbF0sXG4gICAgICBmeTogW251bGxdLFxuICAgICAgYWRkaXRpb25hbEljb246IFsnJ10sXG4gICAgICBpY29uVHlwZTogWydzZWxlY3QnXSxcbiAgICB9LCB7IHZhbGlkYXRvcnM6IHRoaXMuaWNvbk9ySW1hZ2VWYWxpZGF0b3IgfSk7XG4gIH1cblxuICBnZXQgbGFiZWxBcnJheSgpOiBGb3JtQXJyYXkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZUxpbmtGb3JtLmdldCgnbGFiZWwnKSBhcyBGb3JtQXJyYXk7XG4gIH1cblxuICBnZXQgbm9kZUxhYmVsQXJyYXkoKTogRm9ybUFycmF5IHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVOb2RlRm9ybS5nZXQoJ2xhYmVsJykgYXMgRm9ybUFycmF5O1xuICB9XG5cbiAgcHVibGljIGFkZExhYmVsKCkge1xuICAgIGNvbnN0IGxhYmVsR3JvdXAgPSB0aGlzLmZiLmdyb3VwKHtcbiAgICAgIGxhYmVsOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgbGlua0ljb246IFtmYWxzZV0sXG4gICAgfSk7XG4gICAgdGhpcy5sYWJlbEFycmF5LnB1c2gobGFiZWxHcm91cCk7XG4gIH1cblxuICBwdWJsaWMgYWRkTm9kZUxhYmVsKCkge1xuICAgIGNvbnN0IGxhYmVsR3JvdXAgPSB0aGlzLmZiLmdyb3VwKHtcbiAgICAgIGxhYmVsOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgIH0pO1xuICAgIHRoaXMubm9kZUxhYmVsQXJyYXkucHVzaChsYWJlbEdyb3VwKTtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVMYWJlbChpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMubGFiZWxBcnJheS5sZW5ndGggPiAxKSB7XG4gICAgICB0aGlzLmxhYmVsQXJyYXkucmVtb3ZlQXQoaW5kZXgpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVOb2RlTGFiZWwoaW5kZXg6IG51bWJlcikge1xuICAgIGlmICh0aGlzLm5vZGVMYWJlbEFycmF5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIHRoaXMubm9kZUxhYmVsQXJyYXkucmVtb3ZlQXQoaW5kZXgpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCByZXNldExpbmtzRm9ybSgpIHtcbiAgICB0aGlzLmNyZWF0ZUxpbmtGb3JtLnJlc2V0KHtcbiAgICAgIGxpbmVTdHlsZTogJ0RvdHRlZCcsXG4gICAgICBzb3VyY2VBcnJvdzogZmFsc2UsXG4gICAgICB0YXJnZXRBcnJvdzogZmFsc2UsXG4gICAgICBsYWJlbDogdGhpcy5mYi5hcnJheShbXSksXG4gICAgfSk7XG4gICAgdGhpcy5sYWJlbEFycmF5LmNsZWFyKCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcmVzZXROb2RlRm9ybSgpIHtcbiAgICB0aGlzLmNyZWF0ZU5vZGVGb3JtLnJlc2V0KHtcbiAgICAgIGxhYmVsOiB0aGlzLmZiLmFycmF5KFtdKSxcbiAgICAgIGltYWdlVXJsOiAnJyxcbiAgICAgIGljb246ICcnLFxuICAgICAgYWRkaXRpb25hbEljb246ICcnLFxuICAgICAgaWNvblR5cGU6ICdzZWxlY3QnLFxuICAgIH0pO1xuICAgIHRoaXMubm9kZUxhYmVsQXJyYXkuY2xlYXIoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwb3B1bGF0ZUVkaXRMaW5rRm9ybShkYXRhOiBMaW5rKSB7XG4gICAgdGhpcy5jcmVhdGVMaW5rRm9ybS5wYXRjaFZhbHVlKHtcbiAgICAgIGxpbmVTdHlsZTogZGF0YS5saW5lU3R5bGUsXG4gICAgICBzb3VyY2VBcnJvdzogZGF0YS5zb3VyY2VBcnJvdyxcbiAgICAgIHRhcmdldEFycm93OiBkYXRhLnRhcmdldEFycm93XG4gICAgfSk7XG5cbiAgICBpZiAoZGF0YS5yZWxhdGlvbnNoaXBzICYmIEFycmF5LmlzQXJyYXkoZGF0YS5yZWxhdGlvbnNoaXBzKSkge1xuICAgICAgZGF0YS5yZWxhdGlvbnNoaXBzLmZvckVhY2goKHJlbGF0aW9uc2hpcDogUmVsYXRpb25zaGlwKSA9PiB7XG4gICAgICAgIGNvbnN0IGxhYmVsR3JvdXAgPSB0aGlzLmZiLmdyb3VwKHtcbiAgICAgICAgICBsYWJlbEluZGV4OiBbcmVsYXRpb25zaGlwLmxhYmVsSW5kZXgsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgICAgIGxhYmVsOiBbcmVsYXRpb25zaGlwLmxhYmVsLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSxcbiAgICAgICAgICBsaW5rSWNvbjogW3JlbGF0aW9uc2hpcC5saW5rSWNvbl1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGFiZWxBcnJheS5wdXNoKGxhYmVsR3JvdXApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHBvcHVsYXRlRWRpdE5vZGVGb3JtKGRhdGE6IE5vZGUpIHtcbiAgICB0aGlzLmNyZWF0ZU5vZGVGb3JtLnBhdGNoVmFsdWUoe1xuICAgICAgaWQ6IGRhdGEuaWQsXG4gICAgICBpbWFnZVVybDogZGF0YS5pbWFnZVVybCxcbiAgICAgIGljb246IGRhdGEuaWNvbixcbiAgICAgIGZ4OiBkYXRhLmZ4LFxuICAgICAgZnk6IGRhdGEuZnksXG4gICAgICBhZGRpdGlvbmFsSWNvbjogZGF0YS5hZGRpdGlvbmFsSWNvbixcbiAgICAgIGljb25UeXBlOiBkYXRhLmltYWdlVXJsID8gJ3VybCcgOiAnc2VsZWN0J1xuICAgIH0pO1xuXG4gICAgdGhpcy5jcmVhdGVOb2RlRm9ybS5zZXRDb250cm9sKCdsYWJlbCcsIHRoaXMuZmIuYXJyYXkoXG4gICAgICBkYXRhLmxhYmVsLm1hcChsYWJlbCA9PiB0aGlzLmZiLmdyb3VwKHsgbGFiZWw6IFtsYWJlbCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0gfSkpXG4gICAgKSk7XG4gIH1cblxuICBwcml2YXRlIGljb25PckltYWdlVmFsaWRhdG9yKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9IHwgbnVsbCB7XG4gICAgY29uc3QgaW1hZ2VVcmwgPSBjb250cm9sLmdldCgnaW1hZ2VVcmwnKS52YWx1ZTtcbiAgICBjb25zdCBpY29uID0gY29udHJvbC5nZXQoJ2ljb24nKS52YWx1ZTtcbiAgICBpZiAoKGltYWdlVXJsICYmIGljb24pIHx8ICghaW1hZ2VVcmwgJiYgIWljb24pKSB7XG4gICAgICByZXR1cm4geyAnaWNvbk9ySW1hZ2UnOiB0cnVlIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBtaW5MZW5ndGhBcnJheShtaW46IG51bWJlcikge1xuICAgIHJldHVybiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0gfCBudWxsID0+IHtcbiAgICAgIGlmIChjb250cm9sIGluc3RhbmNlb2YgRm9ybUFycmF5KSB7XG4gICAgICAgIHJldHVybiBjb250cm9sLmxlbmd0aCA+PSBtaW4gPyBudWxsIDogeyBtaW5MZW5ndGhBcnJheTogdHJ1ZSB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgfVxufVxuIl19