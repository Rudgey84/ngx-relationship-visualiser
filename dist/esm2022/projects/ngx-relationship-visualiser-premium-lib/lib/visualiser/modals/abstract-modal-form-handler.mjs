import { FormArray, Validators } from '@angular/forms';
import fontAwesomeIcons from '../../models/font-awesome-icons';
export class AbstractModalFormHandler {
    fb;
    createLinkForm;
    createNodeForm;
    fontAwesomeIcons = fontAwesomeIcons;
    constructor(fb) {
        this.fb = fb;
        this.createLinkForm = this.fb.group({
            lineStyle: ['Dotted', Validators.required],
            sourceArrow: [false],
            targetArrow: [false],
            label: this.fb.array([], Validators.required),
        });
        this.createNodeForm = this.fb.group({
            id: '',
            label: this.fb.array([], [Validators.required, this.minLengthArray(1)]),
            imageUrl: [''],
            icon: [''],
            fx: [null],
            fy: [null],
            additionalIcon: [''],
            iconType: ['select'],
        }, { validators: this.iconOrImageValidator });
    }
    get labelArray() {
        return this.createLinkForm.get('label');
    }
    get nodeLabelArray() {
        return this.createNodeForm.get('label');
    }
    addLabel() {
        const labelGroup = this.fb.group({
            label: ['', Validators.required],
            linkIcon: [false],
        });
        this.labelArray.push(labelGroup);
    }
    addNodeLabel() {
        const labelGroup = this.fb.group({
            label: ['', Validators.required],
        });
        this.nodeLabelArray.push(labelGroup);
    }
    removeLabel(index) {
        if (this.labelArray.length > 1) {
            this.labelArray.removeAt(index);
        }
    }
    removeNodeLabel(index) {
        if (this.nodeLabelArray.length > 1) {
            this.nodeLabelArray.removeAt(index);
        }
    }
    resetLinksForm() {
        this.createLinkForm.reset({
            lineStyle: 'Dotted',
            sourceArrow: false,
            targetArrow: false,
            label: this.fb.array([]),
        });
        this.labelArray.clear();
    }
    resetNodeForm() {
        this.createNodeForm.reset({
            label: this.fb.array([]),
            imageUrl: '',
            icon: '',
            additionalIcon: '',
            iconType: 'select',
        });
        this.nodeLabelArray.clear();
    }
    populateEditLinkForm(data) {
        this.createLinkForm.patchValue({
            lineStyle: data.lineStyle,
            sourceArrow: data.sourceArrow,
            targetArrow: data.targetArrow
        });
        if (data.relationships && Array.isArray(data.relationships)) {
            data.relationships.forEach((relationship) => {
                const labelGroup = this.fb.group({
                    labelIndex: [relationship.labelIndex, Validators.required],
                    label: [relationship.label, Validators.required],
                    linkIcon: [relationship.linkIcon]
                });
                this.labelArray.push(labelGroup);
            });
        }
    }
    populateEditNodeForm(data) {
        this.createNodeForm.patchValue({
            id: data.id,
            imageUrl: data.imageUrl,
            icon: data.icon,
            fx: data.fx,
            fy: data.fy,
            additionalIcon: data.additionalIcon,
            iconType: data.imageUrl ? 'url' : 'select'
        });
        this.createNodeForm.setControl('label', this.fb.array(data.label.map(label => this.fb.group({ label: [label, Validators.required] }))));
    }
    iconOrImageValidator(control) {
        const imageUrl = control.get('imageUrl').value;
        const icon = control.get('icon').value;
        if ((imageUrl && icon) || (!imageUrl && !icon)) {
            return { 'iconOrImage': true };
        }
        return null;
    }
    minLengthArray(min) {
        return (control) => {
            if (control instanceof FormArray) {
                return control.length >= min ? null : { minLengthArray: true };
            }
            return null;
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJzdHJhY3QtbW9kYWwtZm9ybS1oYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXJlbGF0aW9uc2hpcC12aXN1YWxpc2VyLXByZW1pdW0tbGliL2xpYi92aXN1YWxpc2VyL21vZGFscy9hYnN0cmFjdC1tb2RhbC1mb3JtLWhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUEwQixTQUFTLEVBQUUsVUFBVSxFQUFtQixNQUFNLGdCQUFnQixDQUFDO0FBRWhHLE9BQU8sZ0JBQWdCLE1BQU0saUNBQWlDLENBQUM7QUFFL0QsTUFBTSxPQUFnQix3QkFBd0I7SUFLdEI7SUFKdEIsY0FBYyxDQUFZO0lBQzFCLGNBQWMsQ0FBWTtJQUNuQixnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQztJQUUzQyxZQUFzQixFQUFlO1FBQWYsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQUNuQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ2xDLFNBQVMsRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDO1lBQzFDLFdBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQztZQUNwQixXQUFXLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDcEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDO1NBQzlDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDbEMsRUFBRSxFQUFFLEVBQUU7WUFDTixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkUsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ2QsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ1YsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQ1YsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQ1YsY0FBYyxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ3BCLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQztTQUNyQixFQUFFLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVELElBQUksVUFBVTtRQUNaLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFjLENBQUM7SUFDdkQsQ0FBQztJQUVELElBQUksY0FBYztRQUNoQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBYyxDQUFDO0lBQ3ZELENBQUM7SUFFTSxRQUFRO1FBQ2IsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDL0IsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUM7WUFDaEMsUUFBUSxFQUFFLENBQUMsS0FBSyxDQUFDO1NBQ2xCLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFTSxZQUFZO1FBQ2pCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQy9CLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDO1NBQ2pDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFTSxXQUFXLENBQUMsS0FBYTtRQUM5QixJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQy9CLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xDLENBQUM7SUFDSCxDQUFDO0lBRU0sZUFBZSxDQUFDLEtBQWE7UUFDbEMsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNuQyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0QyxDQUFDO0lBQ0gsQ0FBQztJQUVTLGNBQWM7UUFDdEIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUM7WUFDeEIsU0FBUyxFQUFFLFFBQVE7WUFDbkIsV0FBVyxFQUFFLEtBQUs7WUFDbEIsV0FBVyxFQUFFLEtBQUs7WUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztTQUN6QixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFUyxhQUFhO1FBQ3JCLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDO1lBQ3hCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDeEIsUUFBUSxFQUFFLEVBQUU7WUFDWixJQUFJLEVBQUUsRUFBRTtZQUNSLGNBQWMsRUFBRSxFQUFFO1lBQ2xCLFFBQVEsRUFBRSxRQUFRO1NBQ25CLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVTLG9CQUFvQixDQUFDLElBQVU7UUFDdkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUM7WUFDN0IsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTO1lBQ3pCLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztZQUM3QixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7U0FDOUIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7WUFDNUQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUEwQixFQUFFLEVBQUU7Z0JBQ3hELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO29CQUMvQixVQUFVLEVBQUUsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUM7b0JBQzFELEtBQUssRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQztvQkFDaEQsUUFBUSxFQUFFLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQztpQkFDbEMsQ0FBQyxDQUFDO2dCQUNILElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ25DLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUM7SUFFUyxvQkFBb0IsQ0FBQyxJQUFVO1FBQ3ZDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDO1lBQzdCLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtZQUNYLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTtZQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDWCxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDWCxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBQWM7WUFDbkMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUTtTQUMzQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUNoRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sb0JBQW9CLENBQUMsT0FBd0I7UUFDbkQsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDL0MsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDdkMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMvQyxPQUFPLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxDQUFDO1FBQ2pDLENBQUM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTyxjQUFjLENBQUMsR0FBVztRQUNoQyxPQUFPLENBQUMsT0FBd0IsRUFBcUMsRUFBRTtZQUNyRSxJQUFJLE9BQU8sWUFBWSxTQUFTLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxPQUFPLENBQUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUNqRSxDQUFDO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUM7SUFDSixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb3JtQnVpbGRlciwgRm9ybUdyb3VwLCBGb3JtQXJyYXksIFZhbGlkYXRvcnMsIEFic3RyYWN0Q29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IExpbmssIFJlbGF0aW9uc2hpcCwgTm9kZSB9IGZyb20gJy4uLy4uL21vZGVscy9kYXRhLmludGVyZmFjZSc7XG5pbXBvcnQgZm9udEF3ZXNvbWVJY29ucyBmcm9tICcuLi8uLi9tb2RlbHMvZm9udC1hd2Vzb21lLWljb25zJztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0TW9kYWxGb3JtSGFuZGxlciB7XG4gIGNyZWF0ZUxpbmtGb3JtOiBGb3JtR3JvdXA7XG4gIGNyZWF0ZU5vZGVGb3JtOiBGb3JtR3JvdXA7XG4gIHB1YmxpYyBmb250QXdlc29tZUljb25zID0gZm9udEF3ZXNvbWVJY29ucztcblxuICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgZmI6IEZvcm1CdWlsZGVyKSB7XG4gICAgdGhpcy5jcmVhdGVMaW5rRm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgbGluZVN0eWxlOiBbJ0RvdHRlZCcsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgc291cmNlQXJyb3c6IFtmYWxzZV0sXG4gICAgICB0YXJnZXRBcnJvdzogW2ZhbHNlXSxcbiAgICAgIGxhYmVsOiB0aGlzLmZiLmFycmF5KFtdLCBWYWxpZGF0b3JzLnJlcXVpcmVkKSxcbiAgICB9KTtcblxuICAgIHRoaXMuY3JlYXRlTm9kZUZvcm0gPSB0aGlzLmZiLmdyb3VwKHtcbiAgICAgIGlkOiAnJyxcbiAgICAgIGxhYmVsOiB0aGlzLmZiLmFycmF5KFtdLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgdGhpcy5taW5MZW5ndGhBcnJheSgxKV0pLFxuICAgICAgaW1hZ2VVcmw6IFsnJ10sXG4gICAgICBpY29uOiBbJyddLFxuICAgICAgZng6IFtudWxsXSxcbiAgICAgIGZ5OiBbbnVsbF0sXG4gICAgICBhZGRpdGlvbmFsSWNvbjogWycnXSxcbiAgICAgIGljb25UeXBlOiBbJ3NlbGVjdCddLFxuICAgIH0sIHsgdmFsaWRhdG9yczogdGhpcy5pY29uT3JJbWFnZVZhbGlkYXRvciB9KTtcbiAgfVxuXG4gIGdldCBsYWJlbEFycmF5KCk6IEZvcm1BcnJheSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlTGlua0Zvcm0uZ2V0KCdsYWJlbCcpIGFzIEZvcm1BcnJheTtcbiAgfVxuXG4gIGdldCBub2RlTGFiZWxBcnJheSgpOiBGb3JtQXJyYXkge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZU5vZGVGb3JtLmdldCgnbGFiZWwnKSBhcyBGb3JtQXJyYXk7XG4gIH1cblxuICBwdWJsaWMgYWRkTGFiZWwoKSB7XG4gICAgY29uc3QgbGFiZWxHcm91cCA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgbGFiZWw6IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICBsaW5rSWNvbjogW2ZhbHNlXSxcbiAgICB9KTtcbiAgICB0aGlzLmxhYmVsQXJyYXkucHVzaChsYWJlbEdyb3VwKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGROb2RlTGFiZWwoKSB7XG4gICAgY29uc3QgbGFiZWxHcm91cCA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgbGFiZWw6IFsnJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgfSk7XG4gICAgdGhpcy5ub2RlTGFiZWxBcnJheS5wdXNoKGxhYmVsR3JvdXApO1xuICB9XG5cbiAgcHVibGljIHJlbW92ZUxhYmVsKGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5sYWJlbEFycmF5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIHRoaXMubGFiZWxBcnJheS5yZW1vdmVBdChpbmRleCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHJlbW92ZU5vZGVMYWJlbChpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMubm9kZUxhYmVsQXJyYXkubGVuZ3RoID4gMSkge1xuICAgICAgdGhpcy5ub2RlTGFiZWxBcnJheS5yZW1vdmVBdChpbmRleCk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIHJlc2V0TGlua3NGb3JtKCkge1xuICAgIHRoaXMuY3JlYXRlTGlua0Zvcm0ucmVzZXQoe1xuICAgICAgbGluZVN0eWxlOiAnRG90dGVkJyxcbiAgICAgIHNvdXJjZUFycm93OiBmYWxzZSxcbiAgICAgIHRhcmdldEFycm93OiBmYWxzZSxcbiAgICAgIGxhYmVsOiB0aGlzLmZiLmFycmF5KFtdKSxcbiAgICB9KTtcbiAgICB0aGlzLmxhYmVsQXJyYXkuY2xlYXIoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCByZXNldE5vZGVGb3JtKCkge1xuICAgIHRoaXMuY3JlYXRlTm9kZUZvcm0ucmVzZXQoe1xuICAgICAgbGFiZWw6IHRoaXMuZmIuYXJyYXkoW10pLFxuICAgICAgaW1hZ2VVcmw6ICcnLFxuICAgICAgaWNvbjogJycsXG4gICAgICBhZGRpdGlvbmFsSWNvbjogJycsXG4gICAgICBpY29uVHlwZTogJ3NlbGVjdCcsXG4gICAgfSk7XG4gICAgdGhpcy5ub2RlTGFiZWxBcnJheS5jbGVhcigpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHBvcHVsYXRlRWRpdExpbmtGb3JtKGRhdGE6IExpbmspIHtcbiAgICB0aGlzLmNyZWF0ZUxpbmtGb3JtLnBhdGNoVmFsdWUoe1xuICAgICAgbGluZVN0eWxlOiBkYXRhLmxpbmVTdHlsZSxcbiAgICAgIHNvdXJjZUFycm93OiBkYXRhLnNvdXJjZUFycm93LFxuICAgICAgdGFyZ2V0QXJyb3c6IGRhdGEudGFyZ2V0QXJyb3dcbiAgICB9KTtcblxuICAgIGlmIChkYXRhLnJlbGF0aW9uc2hpcHMgJiYgQXJyYXkuaXNBcnJheShkYXRhLnJlbGF0aW9uc2hpcHMpKSB7XG4gICAgICBkYXRhLnJlbGF0aW9uc2hpcHMuZm9yRWFjaCgocmVsYXRpb25zaGlwOiBSZWxhdGlvbnNoaXApID0+IHtcbiAgICAgICAgY29uc3QgbGFiZWxHcm91cCA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgICAgIGxhYmVsSW5kZXg6IFtyZWxhdGlvbnNoaXAubGFiZWxJbmRleCwgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgICAgICAgbGFiZWw6IFtyZWxhdGlvbnNoaXAubGFiZWwsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgICAgICAgIGxpbmtJY29uOiBbcmVsYXRpb25zaGlwLmxpbmtJY29uXVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sYWJlbEFycmF5LnB1c2gobGFiZWxHcm91cCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgcG9wdWxhdGVFZGl0Tm9kZUZvcm0oZGF0YTogTm9kZSkge1xuICAgIHRoaXMuY3JlYXRlTm9kZUZvcm0ucGF0Y2hWYWx1ZSh7XG4gICAgICBpZDogZGF0YS5pZCxcbiAgICAgIGltYWdlVXJsOiBkYXRhLmltYWdlVXJsLFxuICAgICAgaWNvbjogZGF0YS5pY29uLFxuICAgICAgZng6IGRhdGEuZngsXG4gICAgICBmeTogZGF0YS5meSxcbiAgICAgIGFkZGl0aW9uYWxJY29uOiBkYXRhLmFkZGl0aW9uYWxJY29uLFxuICAgICAgaWNvblR5cGU6IGRhdGEuaW1hZ2VVcmwgPyAndXJsJyA6ICdzZWxlY3QnXG4gICAgfSk7XG5cbiAgICB0aGlzLmNyZWF0ZU5vZGVGb3JtLnNldENvbnRyb2woJ2xhYmVsJywgdGhpcy5mYi5hcnJheShcbiAgICAgIGRhdGEubGFiZWwubWFwKGxhYmVsID0+IHRoaXMuZmIuZ3JvdXAoeyBsYWJlbDogW2xhYmVsLCBWYWxpZGF0b3JzLnJlcXVpcmVkXSB9KSlcbiAgICApKTtcbiAgfVxuXG4gIHByaXZhdGUgaWNvbk9ySW1hZ2VWYWxpZGF0b3IoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0gfCBudWxsIHtcbiAgICBjb25zdCBpbWFnZVVybCA9IGNvbnRyb2wuZ2V0KCdpbWFnZVVybCcpLnZhbHVlO1xuICAgIGNvbnN0IGljb24gPSBjb250cm9sLmdldCgnaWNvbicpLnZhbHVlO1xuICAgIGlmICgoaW1hZ2VVcmwgJiYgaWNvbikgfHwgKCFpbWFnZVVybCAmJiAhaWNvbikpIHtcbiAgICAgIHJldHVybiB7ICdpY29uT3JJbWFnZSc6IHRydWUgfTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIG1pbkxlbmd0aEFycmF5KG1pbjogbnVtYmVyKSB7XG4gICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiB7IFtrZXk6IHN0cmluZ106IGJvb2xlYW4gfSB8IG51bGwgPT4ge1xuICAgICAgaWYgKGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQXJyYXkpIHtcbiAgICAgICAgcmV0dXJuIGNvbnRyb2wubGVuZ3RoID49IG1pbiA/IG51bGwgOiB7IG1pbkxlbmd0aEFycmF5OiB0cnVlIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICB9XG59XG4iXX0=